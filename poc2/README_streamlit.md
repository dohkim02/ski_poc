# 📊 이상치 분석 시스템 - Streamlit 앱

이 Streamlit 앱은 기존의 `_run.py`, `_preprocess.py`, `utils.py` 코드를 기반으로 웹 인터페이스를 제공합니다.

## 🚀 설치 및 실행

### 1. 의존성 설치

```bash
pip install -r requirements.txt
```

### 2. 앱 실행

```bash
streamlit run streamlit_app.py
```

### 3. 웹 브라우저에서 접속

기본적으로 `http://localhost:8501`에서 앱이 실행됩니다.

## 📋 사용 방법

### 1단계: 데이터 업로드

- 왼쪽 사이드바에서 Excel 파일(.xlsx, .xls)을 업로드합니다
- 분석할 데이터가 포함된 파일을 선택하세요

### 2단계: 전처리

- "전처리 실행" 버튼을 클릭하여 데이터를 전처리합니다
- Excel 파일이 텍스트 형태로 변환됩니다

### 3단계: 분석 실행

- "분석 시작" 버튼을 클릭합니다
- 1차 분석(이상치 탐지) → 2차 분석(패턴 체크) 순으로 진행됩니다

### 4단계: 결과 확인

분석 완료 후 다음과 같은 시각화 옵션을 선택할 수 있습니다:

#### 📊 개별 차트

- 각 케이스별로 기준값 vs 비교값을 개별 차트로 표시
- 확장 가능한 섹션으로 상세 정보 포함
- 패턴 분석 결과와 이유 표시

#### 📈 전체 차트

- 모든 케이스를 하나의 차트에서 비교
- 케이스별로 서브플롯으로 구분

#### 📋 상세 정보

- 테이블 형태로 요약 정보 제공
- 케이스, 카테고리, 판정 결과, 데이터 개수, 이유 등

## 🎨 특징

### 색상 구분

- 각 케이스마다 다른 색상 조합 사용
- 기준값: 실선
- 비교값: 점선
- 6가지 색상 팔레트 순환 사용

### 대화형 차트

- Plotly를 사용한 인터랙티브 차트
- 확대/축소, 호버 정보, 범례 토글 등 지원

### 실시간 진행 상황

- 분석 진행 중 스피너와 진행률 표시
- 각 단계별 완료 메시지

## 📁 파일 구조

```
poc2/
├── streamlit_app.py          # 메인 Streamlit 앱
├── _run.py                   # 핵심 분석 로직
├── _preprocess.py            # 데이터 전처리
├── utils.py                  # 유틸리티 함수들
├── requirements.txt          # 의존성 목록
└── README_streamlit.md       # 이 파일
```

## 🔧 주요 기능

1. **파일 업로드**: Excel 파일 드래그 앤 드롭 또는 클릭하여 업로드
2. **전처리**: 자동으로 데이터를 분석 가능한 형태로 변환
3. **비동기 분석**: 대량 데이터도 효율적으로 처리
4. **시각화**: 직관적인 그래프로 결과 표시
5. **세션 관리**: 분석 결과를 세션에 저장하여 재사용

## ⚠️ 주의사항

- LLM 모델이 초기화되어야 하므로 첫 실행 시 시간이 걸릴 수 있습니다
- 대량의 데이터 분석 시 시간이 오래 걸릴 수 있습니다
- 브라우저를 새로고침하면 분석 결과가 초기화됩니다

## 🐛 문제 해결

### 모델 초기화 오류

```
Error: Could not initialize LLM model
```

- `../model.py` 파일이 올바른 경로에 있는지 확인
- LLM 모델 설정이 올바른지 확인

### 메모리 부족

- 대량 데이터 처리 시 세마포어 값을 줄여보세요 (`semaphore = asyncio.Semaphore(10)`)

### 의존성 오류

```bash
pip install --upgrade -r requirements.txt
```
