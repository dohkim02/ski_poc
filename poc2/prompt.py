CLUSTERING_PROMPT = """
당신은 업종 분류에 특화된 세계 최고의 비즈니스 클러스터링 전문가입니다.

당신의 임무는, 아래 제시된 항목 리스트를 반드시 아래 12개 산업 카테고리 중 **정확히 하나**로 분류하는 것입니다.
입력은 업태와 업종으로 구성된 JSON 객체이며, 각 항목은 다음과 같은 형식입니다:
예시: {{"업태": "교육서비스업", "업종": "직원훈련기관"}}

▼ 당신이 사용할 수 있는 산업 카테고리는 아래 12개뿐입니다:

1. 제조업
2. 건설업
3. 도소매업
4. 서비스업
5. 숙박 및 음식점업
6. 운수업
7. 정보통신업
8. 금융부동산업
9. 교육업
10. 시설관리업
11. 비영리법인
12. 기타

**반드시 아래 규칙을 따르세요**:
- 출력은 입력과 **1:1 대응되는 리스트**여야 합니다 (입력 {output_num}개 → 출력 {output_num}개)
- 출력 리스트에는 반드시 위 **12개 분류명 중 하나만** 포함되어야 하며, **다른 표현, 오타, 유사 단어는 허용되지 않습니다**
- 반드시 하나의 카테고리만 선택할 것 (중복, 다중 선택 금지)
- 절대로 새로운 카테고리를 생성하거나, 예시 외 카테고리를 쓰지 마십시오
- **반드시** 아래 형식으로 출력하세요:  
  `["숙박 및 음식점업", "기타", "교육업", ..., "도소매업"]`  
  - 리스트 이외의 어떤 설명도 포함하지 말 것
  - 숫자 접두어(예: "1. 제조업")도 포함하지 말 것
  - 줄바꿈 없이 한 줄로 출력할 것

이제 분류할 업태/업종 리스트는 다음과 같습니다:
{biz_lst}
"""

CLASSIFY_DATA_GROUP = """
아래 입력값을 보고 어떤 그룹에 속하는지 정확히 하나만 분류하라.

[그룹]
"0": "건설업",
"1": "교육업",
"2": "금융부동산업",
"3": "기타",
"4": "도소매업",
"5": "비영리법인",
"6": "서비스업",
"7": "숙박 및 음식점업",
"8": "시설관리업",
"9": "운수업",
"10": "정보통신업",
"11": "제조업"

입력: {data}

출력 형식: 그룹에 해당하는 **숫자를 문자열로만** 반환하라 (예: "0", "1", ..., "11"). 그 외 텍스트는 포함하지 마라.
"""

JUDGE_WITH_GROUND_TRUTH_PROMPT = """
다음은 기준 데이터와 새로운 데이터입니다. 기준 데이터의 median과 IQR을 기반으로 각 월별 사용량이 이상치인지 판단해주세요.

이상치 판별 기준:
- 각 월별 이상치 범위는 아래와 같이 계산됩니다:
  하한 = median - 1.5 * IQR  
  상한 = median + 1.5 * IQR

- **이상치로 판단하는 조건은 다음과 같으며, 매우 엄격하게 적용해야 합니다:**
  - 실제값 > 상한  → 이상치  
  - 실제값 < 하한  → 이상치  
  - **주의: 실제값이 상한 또는 하한과 '정확히 같은 경우'는 정상입니다.**

최종 판단 기준:
- 월별 이상치가 월 번호 기준으로 **3개월 이상 연속** 발생한 경우에만 `result`를 "이상"으로 판단합니다.
- 예: 7월, 8월, 9월이 모두 이상치 → "이상"
- 중간에 한 달이라도 정상인 경우 → 연속성 끊김 → "정상"
- 연속 이상치가 1~2개월만 발생한 경우도 "정상"

출력 형식:
- `result`: "정상" 또는 "이상" (반드시 이 두 단어 중 하나만 출력)
- `reason`:
  - result가 "정상"인 경우: 빈 문자열("")로 출력
  - result가 "이상"인 경우: 아래 형식으로 설명 + 표를 출력
    ```
    이상치가 연속적으로 3개월 이상 발생했습니다.

    | 월   | 기준값 | 하한 | 상한 | 실제값 |
    |------|--------|------|------|--------|
    | 7월  | 257.78 | -376.21 | 891.77 | 3546.25 |
    | 8월  | 252.32 | -385.03 | 889.67 | 3486.54 |
    | 9월  | 235.15 | -347.11 | 817.41 | 3293.10 |
    ```
  - 표에는 **연속된 이상치인 월만** 포함되며, 월 번호 순으로 정렬합니다.
  - **정상값은 절대 표에 포함되지 않아야 하며**, 이상치가 아닌 값이 포함되면 오답으로 간주됩니다.

주의사항:
- 하한 또는 상한과 **정확히 같은 값은 정상**입니다. (예: 실제값 == 상한 → 정상)
- 연속성 판단은 반드시 월 번호 기준(1월~12월)으로 진행하세요.
- 월 이름(예: "1월")은 표기용이며, 순서 판단은 월 번호로 판단해야 합니다.

[신규 데이터]  
{data}

[기준 데이터]  
{ground_truth}
"""

JUDGE_BIZ__STD_PROMPT = """
너는 월별 사용량 패턴을 파악하여, 이상 데이터를 판단하는 AI이다.
다음은 한 업종의 평균 월별 사용량과 표준편차이며, 입력된 데이터는 같은 업종의 다른 사업체의 월별 사용량이다.

입력된 데이터가 평균 대비 표준편차 범위를 벗어난 이상치인지 판단하라.

판단 기준:
- 표준편차를 한참 벗어나는 월이 여러 개 있다면 '이상'
- 대부분 범위 내에 있다면 '정상'

반드시 다음 형식으로만 답하라:
- result: "정상" 또는 "이상"
- reason: 이상치라고 판단한 경우에만 수치적으로 구체적인 이유를 설명.

[기준 데이터]
{gt_data_str}

[입력 데이터]
{data}
"""

REPORTER_PROMPT = """
너는 이상 데이터 분석 결과들을 종합해 최종 보고서를 작성하는 전문가 AI이다.

아래 "입력 리포트"는 서로 다른 {N}개의 LLM 분석 결과로, 각 리포트는 통계 기준(예: 평균, 표준편차)을 활용하여 **패턴에서 벗어난 이상 데이터를 식별**한 결과이다.  
이 리포트들에는 일부 중복 항목이나 유사한 판단 기준이 포함되어 있으며, 모두 월별 사용 패턴을 포함하고 있다.

너의 임무는 다음과 같다:
- 입력된 리포트 중 **통계적으로 신뢰도 높고 대표적인 이상 사례들**을 바탕으로, **최종 보고서**를 작성하라.
- 이상 사례의 판단 기준은 다음 중 하나 이상을 충족해야 한다:
    - 모든 월에서 평균보다 지속적으로 낮거나 높은 **전형적인 이상 패턴**
    - 특정 월에서 극단적 수치로 평균 ± 2.5σ 이상 벗어나는 **통계적 이상치**
    - 계절성 패턴을 완전히 무시하는 **비상식적 패턴**
    - 열량이나 사용량이 비정상적으로 0에 가깝거나 과도하게 높은 경우
    - 유사 업종 대비 이상 수치가 두드러지는 항목
- 리포트 상에 드러나지 않도록 하되, 위 기준을 만족하는 **전체 중 약 1% 수준의 데이터만 사용하여 작성**하라.  
(*단, 출력물에는 '1%' 또는 '선별'이라는 표현이 절대 포함되어선 안 된다.*)

### 작성 규칙:
1. **중복된 항목**은 하나로 통합하되, 중요한 정보(이상 사유 등)는 병합하여 유지한다.
2. 각 데이터 항목은 다음 정보를 반드시 포함해야 한다:
    - category
    - 구분(식별자)
    - 업태, 업종, 용도
    - 연소기 열량, 보일러 열량
    - 월별 사용량 / 평균 / 표준편차 (마크다운 표 형식) 
    - 이상 판단 사유 (구체적 이유)
3. 리포트 형식은 다음을 따라야 한다:
    - 제목 (예: "이상 데이터 검출 결과")
    - 항목별 정리
    - 최종 결론 (전체 요약 및 시사점 포함)
4. **전문적이고 간결한 어투**로 작성할 것.

---

[입력 리포트]
{results}
"""

PATTERN_CHECK_PROMPT = """
다음은 년도 별 월별 사용량 데이터입니다:
{key0}년도 데이터: {value0}
{key1}년도 데이터: {value1}
{key2}년도 데이터: {value2}
{key3}년도 데이터: {value3}

당신의 임무는, **최근 6개월 데이터가 과거 연도들과 비교해 '지속적이고 복구되지 않는 하락 추세(=내리막 패턴)'에 해당하는지 여부를 판단하는 것**입니다.

다음 조건을 반드시 충족해야만 이상(내리막 패턴)으로 간주합니다:
- 최근 6개월 중 특정 시점 이후 수치가 **계속 하락하거나**,  
- 하락한 이후 **반등 없이 낮은 수준이 유지되는 경우**

다음과 같은 경우는 **이상 패턴이 아닙니다 (즉, 정상입니다):**
- 수치가 일정하게 유지됨
- 수치가 오르락내리락 반복함 (변동 있음)
- 하락 후 다시 반등한 경우
- 평균보다 낮은 것만으로는 판단하지 않음

또한, **2025년 데이터가 다시 반등하거나 회복세를 보인다면 이상으로 간주하지 않습니다.**

[출력 형식 지침]:
- 이상 여부: `"yes"` 또는 `"no"`로만 대답
- 만약 `"yes"`라면, 반드시 다음 내용을 `reason`에 포함할 것:
  - **이상이 시작된 월 (ex: "2025년 3월부터")**
  - **하락 폭 및 이전 수치와 비교해 얼마나 감소했는지 (정확한 수치 포함)**
"""
